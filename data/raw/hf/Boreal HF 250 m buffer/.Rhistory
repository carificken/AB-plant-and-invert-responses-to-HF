# load and clean wetland classification - wetland sites
{
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/Wetland data")
siteclass_wet <- read.csv("A_W02B_Site_Capability.csv")
# remove missing classificaiton values, and only retain the dominant site classification
levels(siteclass_wet$Ecosite...Nutrient.Moisture.Code)
siteclass_wet <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code!="DNC" &
Ecosite...Nutrient.Moisture.Code!="NONE",
Ecosite...Nutrient.Moisture.Code!="VNA")
siteclass_wet <- droplevels(siteclass_wet)
# siteclass_wet$Percent.Area.of.Ecological.Site.Classification <- as.numeric(levels(siteclass_wet$Percent.Area.of.Ecological.Site.Classification))[siteclass_wet$Percent.Area.of.Ecological.Site.Classification]
# separate sites by wetland type
names(siteclass_wet)
bogsites_wetland <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code == "(08) PD") %>% select(Site="ABMI.Site")
fensites_wetland <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code == "(09) MD" |
Ecosite...Nutrient.Moisture.Code == "(10) RDp" |
Ecosite...Nutrient.Moisture.Code == "(13) AD") %>% select(Site="ABMI.Site")
wetmeadowsites_wetland <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code == "(10.5) RDm") %>% select(Site="ABMI.Site")
marshsites_wetland <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code == "(11) VD") %>% select(Site="ABMI.Site")
swampsites_wetland <- siteclass_wet %>% filter(Ecosite...Nutrient.Moisture.Code == "(12) SD") %>% select(Site="ABMI.Site")
# add wetland type ID and combine datasets
bogsites_wetland$WetlandType <- "Bog"
fensites_wetland$WetlandType <- "Fen"
wetmeadowsites_wetland$WetlandType <- "Wet Meadow"
marshsites_wetland$WetlandType <- "Marsh"
wetlandclassification_wetland <- rbind(bogsites_wetland,
fensites_wetland,
wetmeadowsites_wetland,
marshsites_wetland)
# extract proper site names add "wet" before site id
# extract proper site names
# wetlandclassification_wetland <- wetlandclassification_wetland %>%
#   mutate(newid=paste(str_extract(Site, "OG-"),
#                      str_extract(Site, "[[:digit:]]+"), sep="")) %>%
#   mutate(Site = gsub('NA', '', newid)) %>%
#   select(WetlandType,Site)
#  wetlandclassification_wetland$Site <- paste("wet_",wetlandclassification_wetland$Site, sep="")
# MANY sites have repeated site classifications;
# wetlandclassification_wetland <- wetlandclassification_wetland %>% distinct()
wetlandclassification_wetland %>% group_by(Site,WetlandType) %>% tally() %>% filter(n>1) %>% arrange(desc(n))
# note: many sites have multiple ecosite classifications; must take the DOMINANT classification ie the one which occurs most often
wetlandclassification_wetland <- wetlandclassification_wetland %>% group_by(Site,WetlandType) %>% tally() %>% ungroup() %>% group_by(Site) %>% filter(n==max(n)) %>% select(Site,WetlandType)
# we still have 37 sites w/ double split classifications; ammend manually
wetlandclassification_wetland %>% group_by(Site) %>% tally() %>% filter(n>1) %>% arrange(desc(n)) %>% select(Site) %>% data.frame()
# marsh + wet meadow >> marsh
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_956","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1057","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1333","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1363","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1370","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1429","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1435","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1611","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1651","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_236","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_826","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_956","WetlandType"] <- "Marsh"
# bog + marsh >> "bog"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_154","WetlandType"] <- "Bog"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_20","WetlandType"] <- "Bog"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_362","WetlandType"] <- "Bog"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_416","WetlandType"] <- "Bog"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_469","WetlandType"] <- "Bog"
# fen + marsh >> marsh
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_157","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_1570","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_237","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_247","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_387","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_418","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_467","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_553","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_754","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_829","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_851","WetlandType"] <- "Marsh"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_899","WetlandType"] <- "Marsh"
# bog + fen >> Fen
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_16","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_295","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_298","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_417","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_560","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_580","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_621","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_726","WetlandType"] <- "Fen"
wetlandclassification_wetland[wetlandclassification_wetland$Site=="wet_842","WetlandType"] <- "Fen"
# delete repeated Site classificaitons
wetlandclassification_wetland <- wetlandclassification_wetland %>% distinct()
# check to make sure each site has only 1 wetland classification
wetlandclassification_wetland %>% select(Site) %>% unique() %>% nrow() # 810 unique sites
wetlandclassification_wetland %>% select(Site, WetlandType) %>% unique() %>% nrow() # 810 unique site x wetlandtypes
}
# combine wetland classifications
wetlandclassification_all <- bind_rows(wetlandclassification, wetlandclassification_wetland)
# add wetland class to plant veg df
{
plant_pa <- left_join(plant_pa, wetlandclassification_all, by="Site") %>% select(WetlandType,Site,Year,everything())
tmp <- filter(plant_pa, is.na(WetlandType) & str_detect(Site,"wet_"))
tmp$WetlandType <- "Shallow Lake"
plant_pa <- plant_pa %>% filter(!is.na(WetlandType))
plant_pa <- bind_rows(plant_pa,tmp)
}
setwd("/Users/cari/Desktop/Waterloo/ABMI Data")
ter_osr <- read.csv("Terrestrial sites in OSR.csv")
names(ter_osr) <- "Site"
wet_osr <- read.csv("Wetland sites in OSR.csv")
names(wet_osr) <- "Site"
# combine
osr_sites <- bind_rows(ter_osr,wet_osr)
# filter plant data set by sites in OSR
plant_pa <- plant_pa %>% filter(Site %in% osr_sites$Site)
dim(plant_pa)
plant_pa %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE ) %>%
arrange(Site)
# For every site-year of veg data, I want to have hf data
# for MATCHING sites, the HF data were collected on the same years as the veg data
# but for MISMATCHING sites, i have veg data collected on offset years; for these i need to take average of HF data from 2 closest years
library(tidyverse); library(readxl); library(data.table)
# first load HF datasets
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF/vHFBuffer250m")
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF")
wet_hf <- read.csv("Wetland-ABMI-all-sites-HF-250mBuffer-BorealNR.csv")
# load grouping vars
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data")
hfgrouping_vars <- read.csv("HF grouping vars.csv")
# average HF for sites with replicate measures (i.e. HF measured on different transects?)
# extract proper site names
ter_hf <- ter_hf %>% select(Site=ABMI_Assigned_Site_ID,everything()) # rename site to Site
ter_hf %>% group_by(Site,Year,FEATURE_TY)
head(ter_hf)
# first load HF datasets
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF/vHFBuffer250m")
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF")
wet_hf <- read.csv("Wetland-ABMI-all-sites-HF-250mBuffer-BorealNR.csv")
# load grouping vars
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data")
hfgrouping_vars <- read.csv("HF grouping vars.csv")
# average HF for sites with replicate measures (i.e. HF measured on different transects?)
# extract proper site names
ter_hf <- ter_hf %>% select(Site=ABMI_Assigned_Site_ID,Year=survey_year,everything()) # rename site to Site
head(ter_hf)
ter_hf %>% group_by(Site,Year,FEATURE_TY)
ter_hf %>% group_by(Site,Year,FEATURE_TY) %>% tally()
ter_hf %>% group_by(Site,Year,FEATURE_TY) %>% tally() %>% arrange(desc(n))
# ter_hf <- ter_hf %>%
#   mutate(newid=paste(str_extract(Site, "OG-"),
#                      str_extract(Site, "[[:digit:]]+"), sep="")) %>%
#   mutate(Site = gsub('NA', '', newid)) %>%
# select(Site,) %>%
# select(-Site,-newid)
# there are multiple "Acreage" areas estimated for a number of sites; sum them
ter_hf <- ter_hf %>% group_by(Site,Year,FEATURE_TY) %>% summarize(Shape_Area=sum(Shape_Area))
head(ter_hf)
ter_hf %>% group_by(Site,Year) %>% summarize(totdist=sum(Shape_Area))
ter_hf %>% group_by(Site,Year) %>% summarize(totdist=sum(Shape_Area),propdist=totdist/(pi*250^2))
ter_hf %>% group_by(Site,Year) %>% summarize(totdist=sum(Shape_Area),propdist=totdist/(pi*250^2)) %>% filter(propdist>1)
head(ter_hf)
# spread, then re-gather to replace NAs with 0s
ter_hf <- ter_hf %>% select(Site,Year,FEATURE_TY,Shape_Area) %>%
spread(., key=FEATURE_TY, value=Shape_Area) %>%
gather(., FEATURE_TY,Shape_Area, 3:ncol(.)) %>%
replace_na(list(Shape_Area=0))
# note that the "Feature_TY" levels need to be consolidated into ~20 higher DistTypes
ter_hf <- left_join(ter_hf,hfgrouping_vars, by="FEATURE_TY") %>%
select(-FEATURE_TY) %>%
group_by(Site,Year,DistType,HFCategory) %>%
summarize(Area=sum(Shape_Area))
# area is now in m2; convert to km2
ter_hf$Area <- ter_hf$Area/1000000
# for clarity remove HFCategory column
ter_hf <- select(ter_hf,-HFCategory)
wet_hf <- wet_hf %>% select(Site=Site,Year,everything())
head(wet_hf)
# wet_hf <- wet_hf %>%
#   mutate(newid=paste(str_extract(Site, "OG-"),
#                      str_extract(Site, "[[:digit:]]+"), sep="")) %>%
#   mutate(Site = gsub('NA', '', newid)) %>%
#   select(Site,Year,everything() ) %>%
#   select(-Site,-newid)
wet_hf$Site <- paste("wet_",wet_hf$Site, sep="")
# consolidate the FEATURE_TYs into DistTypes
wet_hf <- wet_hf %>% gather(FEATURE_TY,Shape_Area,3:ncol(wet_hf))
wet_hf <- left_join(wet_hf,hfgrouping_vars,by="FEATURE_TY") %>%
select(-FEATURE_TY) %>%
group_by(Site,Year,DistType,HFCategory) %>%
summarize(Area=sum(Shape_Area))
# Area is now in % (*******I THINK******); convert to km2
wet_hf$Area <- wet_hf$Area*(pi*0.25^2) # area of circle with 0.25km radius
# for clarity remove HFCategory column
wet_hf <- select(wet_hf,-HFCategory)
# # final data frame needs to be wide
ter_hf <- ter_hf %>% spread(DistType,Area)
wet_hf <- wet_hf %>% spread(DistType,Area)
# combine datasets
hf_full <- bind_rows(ter_hf, wet_hf)
# note that the ter data set did not include canals, rails, or windgenerationfacilities; must replace NAs with 0s
hf_full <- replace_na(hf_full, list(Canals=0, Rails=0, WindGenerationFacility=0))
# filter based on site in OSR
# load list of OSR sites
{
setwd("/Users/cari/Desktop/Waterloo/ABMI Data")
# ter sites
{
ter_osr <- read.csv("Terrestrial sites in OSR.csv")
names(ter_osr) <- "Site"
# ter_osr <- ter_osr %>%
#   mutate(newid=paste(str_extract(Site, "OG-"),
#                      str_extract(Site, "[[:digit:]]+"), sep="")) %>%
#   mutate(Site = gsub('NA', '', newid)) %>%
#   select(Site)
}
# wetland sites
{
wet_osr <- read.csv("Wetland sites in OSR.csv")
names(wet_osr) <- "Site"
# wet_osr <- wet_osr %>%
#   mutate(newid=paste(str_extract(Site, "OG-"),
#                      str_extract(Site, "[[:digit:]]+"), sep="")) %>%
#   mutate(Site = gsub('NA', '', newid)) %>%
#   select(Site)
wet_osr$Site <- paste("wet_",wet_osr$Site, sep="")
}
# combine
osr_sites <- bind_rows(ter_osr,wet_osr)
}
hf_full <- hf_full %>% filter(Site %in% osr_sites$Site)
head(hf_full)
hf_full %>% summarize(totarea=rowSums(hf_full[,3:ncol(hf_full)]))
hf_full %>% rowwise() %>% summarize(totarea=rowSums(hf_full[,3:ncol(hf_full)]))
rowSums(hf_full[,3:ncol(hf_full)])
cbind(hf_full$Site,hf_full$Year,rowSums(hf_full[,3:ncol(hf_full)]))
data.frame(hf_full$Site,hf_full$Year,rowSums(hf_full[,3:ncol(hf_full)]))
data.frame(hf_full$Site,hf_full$Year,rowSums(hf_full[,3:ncol(hf_full)])) %>% colnames()
data.frame(hf_full$Site,hf_full$Year,rowSums(hf_full[,3:ncol(hf_full)])) ->tmp
colnames(tmp) <- c("Site","Year","TotArea")
head(tmp)
tmp %>% filter(TotArea>(pi*0.25^2))
tmp %>% filter(TotArea>=(pi*0.25^2))
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE ) %>%
arrange(Site)
tmp %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year) %>% head()
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE )  %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year) %>% head()
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE )
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE ) %>% head()
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE )  %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year) %>% head()
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE )  %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+"),
str_extract(Site,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year) %>% head()
tmp %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE )  %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+-"),
str_extract(Site,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year) %>% head()
source('~/Desktop/Waterloo/R files/OSR analyses only/OSR 01 Interpolating HF data with rolling joins.R', echo=TRUE)
rm(list=ls())
# first load HF datasets
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF/vHFBuffer250m")
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF")
wet_hf <- read.csv("Wetland-ABMI-all-sites-HF-250mBuffer-BorealNR.csv")
# load grouping vars
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data")
hfgrouping_vars <- read.csv("HF grouping vars.csv")
# average HF for sites with replicate measures (i.e. HF measured on different transects?)
# extract proper site names
ter_hf <- ter_hf %>% select(tmpSite=ABMI_Assigned_Site_ID,everything()) # rename site to tmpsite
ter_hf <- ter_hf %>%
mutate(newid=paste(str_extract(Site, "OG-"),
str_extract(Site, "[[:digit:]]+-"),
str_extract(Site,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
ter_hf <- ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+"),
str_extract(Site,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
ter_hf <- ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
head(ter_hf)
# first load HF datasets
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF/vHFBuffer250m")
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
# average HF for sites with replicate measures (i.e. HF measured on different transects?)
# extract proper site names
ter_hf <- ter_hf %>% select(tmpSite=ABMI_Assigned_Site_ID,everything()) # rename site to tmpsite
head(ter_hf)
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid) %>% head()
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid) %>% tail()
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid) %>% select(Site)
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid) %>% select(distinct(Site))
ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid) %>% select(Site) %>% distinct()
ter_hf <- ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+-"),
str_extract(tmpSite,"[[:digit:]]+$"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
ter_hf %>% group_by(Site,Year,FEATURE_TY) %>% summarize(Shape_Area=sum(Shape_Area))
ter_hf %>% group_by(Site,Year) %>% summarize(Shape_Area=sum(Shape_Area))
ter_hf %>% group_by(Site,Year) %>% summarize(Shape_Area=sum(Shape_Area)) %>% filter(Shape_Area>(pi*250^2))
ter_hf %>% group_by(Site,Year) %>% summarize(Shape_Area=sum(Shape_Area)) %>% filter(Shape_Area>=(pi*250^2))
head(hf_full)
head(ter_hf)
dim(ter_hf)
dim(distinct(her_hf))
dim(distinct(ter_hf))
ter_hf %>% group_by(Site,Year) %>% summarize(Shape_Area=sum(Shape_Area)) %>% filter(Shape_Area>=(pi*250^2))
ter_hf %>% filter(Site=="OG-583-21")
ter_hf %>% select(-OBJECTID)
ter_hf %>% select(-OBJECTID) %>% dim()
ter_hf %>% select(-OBJECTID) %>% distinct() %>% dim()
ter_hf %>% select(-OBJECTID) %>% filter(Site=="OG-583-21") %>% dim()
ter_hf %>% select(-OBJECTID) %>% filter(Site=="OG-583-21") %>% distinct() %>% dim()
# first load HF datasets
setwd("/Users/cari/Desktop/Waterloo/ABMI Data/HF data/Site specific HF/vHFBuffer250m")
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
# average HF for sites with replicate measures (i.e. HF measured on different transects?)
# extract proper site names
ter_hf <- ter_hf %>% select(tmpSite=ABMI_Assigned_Site_ID,everything()) # rename site to tmpsite
ter_hf <- ter_hf %>%
mutate(newid=paste(str_extract(tmpSite, "OG-"),
str_extract(tmpSite, "[[:digit:]]+"), sep="")) %>%
mutate(Site = gsub('NA', '', newid)) %>%
select(Site,Year=survey_year,everything() ) %>%
select(-tmpSite,-newid)
head(ter_hf)
ter_hf %>% group_by(Site,Year,FEATURE_TY) %>% dim()
names(ter_hf)
head(ter_hf)
ter_hf %>% select(Site,Year,FEATURE_TY,Shape_Area) %>% dim()
ter_hf %>% select(Site,Year,FEATURE_TY,Shape_Area) %>% distinct() %>% dim()
head(ter_hf)
ter_hf %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE ) %>%
arrange(Site)
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
head(ter_hf)
ter_hf <- ter_hf %>% select(Site=ABMI_Assigned_Site_ID,Year=survey_year)
head(ter_hf)
ter_hf %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE ) %>%
arrange(Site)
ter_hf %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE |
str_detect(Site, "-31$")==TRUE) %>%
arrange(Site)
ter_hf <- read.csv("All_HF_buff250m_OfficialNR_BorealRegion_2003_2016.csv")
ter_hf <- ter_hf %>% select(Site=ABMI_Assigned_Site_ID,Year=survey_year,everything())
ter_hf %>% select(Site,Year) %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE |
str_detect(Site, "-31$")==TRUE) %>%
arrange(Site)
ter_hf %>% dim()
ter_hf %>% distinct() %>% dim()
names(ter_hf)
ter_hf %>% select(Site,Year,FEATURE_TY,Shape_Area) -> tmp
dim(tmp)
dim(distinct(tmp))
tmp %>% distinct() %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE |
str_detect(Site, "-31$")==TRUE) %>%
arrange(Site)
tmp %>% distinct(Site,Year) %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE |
str_detect(Site, "-31$")==TRUE) %>%
arrange(Site)
tmp %>% distinct(Site,Year) %>% filter(str_detect(Site, "-1$")==TRUE |
str_detect(Site, "-11$")==TRUE |
str_detect(Site, "-2$")==TRUE |
str_detect(Site, "-21$")==TRUE |
str_detect(Site, "-22$")==TRUE |
str_detect(Site, "-31$")==TRUE) %>%
arrange(Site) ->namestokeep
head(tmp)
tmp %>% spread(FEATURE_TY,SHAPE_AREA)
tmp %>% spread(FEATURE_TY,Shape_Area)
tmp %>% filter(Site %in% tmp$Site)
namestokeep
tmp %>% filter(Site %in% tmp$Site) %>% head()
tmp %>% filter(Site %in% namestokeep$Site) %>% head()
ter_hf %>% filter(Site %in% namestokeep$Site) %>% head()
ter_hf %>% filter(Site %in% namestokeep$Site) %>% View()
ter_hf %>% tally()
head(ter_hf)
ter_hf %>% group_by(colnames(ter_hf)) %>% tally()
colnames(ter_hf)
ter_hf %>% group_by(Site,Year,FEATURE_TY,Shape_Area) %>% tally()
ter_hf %>% group_by(Site,Year,FEATURE_TY,Shape_Area) %>% tally() %>% arrange(desc(n))
ter_hf %>% group_by(Site,Year,FEATURE_TY,Shape_Area) %>% tally() %>% filter(n>1) %>%  arrange(desc(n))
ter_hf %>% group_by(Site,Year,FEATURE_TY,Shape_Area) %>% tally() %>% filter(n>1) %>%  arrange(desc(n)) %>% View()
